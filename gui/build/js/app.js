var configFn,app;configFn=function(e,a){e.theme("default").primaryPalette("blue").accentPalette("light-blue"),a.setBaseUrl("http://10.60.19.11:8080/ioam")},configFn.$inject=["$mdThemingProvider","RestangularProvider"],app=angular.module("ioamApp",["ngMaterial","restangular","md.data.table"]),app.config(configFn),function(e){var a=function(e,a,t){this.debug=!0,this.defaultMethod="toast",this.displayMDToast=function(e){t.show({hideDelay:1e4,position:"bottom right",controller:"ErrorHandlerCtrl",templateUrl:"templates/error-views/toast.tpl.html",locals:{errData:e}})},this.displayMDDialog=function(e){var t=angular.element(document.body);a.show({parent:t,controller:"ErrorHandlerCtrl",templateUrl:"templates/error-views/dialog.tpl.html",clickOutsideToClose:!0,locals:{errData:e}})},this.displayPopupByDefault=function(e){switch(this.defaultMethod){case"toast":this.displayMDToast(e);break;case"dialog":this.displayMDDialog(e)}},this.log=function(a,t){t=t||!1;var r=!0;if(t)if(t===!0)this.displayPopupByDefault(a);else{if(t.hasOwnProperty("type"))switch(t.type){case"dialog":this.displayMDDialog(a);break;case"toast":this.displayMDToast(a);break;case"default":this.displayPopupByDefault(a);break;case"hide":}else this.displayPopupByDefault(a);t.hasOwnProperty("allowToLogInConsole")&&(r="boolean"==typeof t.allowToLogInConsole?t.allowToLogInConsole:!1)}this.debug&&r&&e.error("Error occurred.",a)}};a.$inject=["$log","$mdDialog","$mdToast"],e.service("ErrorHandlerService",a)}(app),function(e){var a=function(){function e(e,t){t=t||!1;for(var r in e)e.hasOwnProperty(r)&&(t?a.data[r]=angular.copy(e[r]):a.data[r]=e[r])}var a=this;this.multiSet=e,this.data={sidePanel:!1,sidePanelName:null,apiSettings:null,openPanel:null}};a.$inject=[],e.service("SharedDataService",a)}(app),function(e){var a=function(){function e(e,a){for(var t=e,r=0;r<a.length;r++){if(!t.hasOwnProperty(a[r]))return!1;t=t[a[r]]}return!0}function a(e,a,t){var r;return function(){var n=this,o=arguments,i=function(){r=null,t||e.apply(n,o)},l=t&&!r;clearTimeout(r),r=setTimeout(i,a),l&&e.apply(n,o)}}function t(e){var a=0;return e.forEach(function(e){a+=e}),a}function r(e){return"object"==typeof e&&null!==e}function n(e,a){if(Array.isArray(a)){for(var t=0;t<a.length;t++)if(!e.hasOwnProperty(a[t]))return!1;return!0}return!1}this.hasOwnPropertiesPath=e,this.debounce=a,this.arraySum=t,this.isTrueObject=r,this.hasOwnProperties=n};a.$inject=[],e.service("HelpersService",a)}(app),function(e){var a=function(e,a){function t(t,r,n){""===t.url&&(t.url=window.location.protocol+"//"+window.location.hostname+":"+window.location.port);var o=e.setBaseUrl(t.url).one("sla"),i={StartTime:t.startTime,EndTime:t.endTime,"target-delay":t.targetDelay,"target-jitter":t.targetJitter};o.customPOST(i).then(function(e){if(a.hasOwnPropertiesPath(e,["SLA compliance"]))r(e["SLA compliance"]);else{var t={errCode:"GET_SLA_INVALID",errTitle:"Couldn't read SLA compliance data",errMsg:"SLA compliance data is invalid.",errResolution:"Make sure that protocols match.",errObj:e};n(t)}},function(e){var a={errCode:"GET_SLA",errTitle:"Couldn't get SLA compliance data",errMsg:"You tried to read SLA compliance data from server, but for some reason it is being complicated at this point.",errResolution:"Check your connection, otherwise make sure if REST server is up.",errObj:e};n(a)})}this.getSla=t};a.$inject=["Restangular","HelpersService"],e.service("ApiService",a)}(app),function(e){var a=function(){function e(e,a){var r=[];if(Array.isArray(e))return r=e.map(function(e){return t.createDonutChart(e,a)});if("object"==typeof e&&null!==e){var n={scales:{gridLines:{}},legend:{display:!1}},o={labels:[e.labels.primary,e.labels.secondary],datasets:[{data:[e.activePercentage,100-e.activePercentage],backgroundColor:["#009933","#ff0000"],hoverBackgroundColor:["#009933","#ff0000"]}]},i=document.getElementById(e.htmlId+"-"+a).getContext("2d"),l=new Chart(i,{type:"doughnut",data:o,options:n});return Chart.pluginService.register({beforeDraw:function(a){if(l===a){var t=a.chart.width,r=a.chart.height,n=a.chart.ctx;n.restore();var o=(r/114).toFixed(2);n.font=o+"em sans-serif",n.textBaseline="middle";var i=e.reversePercentage?100-e.activePercentage+"%":e.activePercentage+"%",s=Math.round((t-n.measureText(i).width)/2),c=r/2;n.fillText(i,s,c),n.save()}}}),l}}function a(e,a){var r=[];if(Array.isArray(e))return r=e.map(function(e){return t.createBarChart(e,a)});if("object"==typeof e&&null!==e){var n={scales:{gridLines:{}},legend:{display:!1}},o=[],i=[];e.bars.forEach(function(e){i.push(e.value),o.push(e.label)});var l={labels:o,datasets:[{data:i,backgroundColor:"#99bbff",hoverBackgroundColor:"#6699ff"}]},s=document.getElementById(e.htmlId+"-"+a).getContext("2d"),c=new Chart(s,{type:"bar",data:l,options:n});return c}}var t=this;this.createDonutChart=e,this.createBarChart=a};a.$inject=[],e.service("ChartService",a)}(app),function(e){var a=function(e,a,t,r,n){e.errData=a,e.closeDialog=function(){r.hide()},e.showMoreInfoInDialog=function(){e.closeToast(),n.log(e.errData,{type:"dialog",allowTologInConsole:!1})},e.closeToast=function(){t.hide().then(function(){})}};a.$inject=["$scope","errData","$mdToast","$mdDialog","ErrorHandlerService"],e.controller("ErrorHandlerCtrl",a)}(app),function(e){var a=function(e,a,t){function r(e){t.data.sidePanel=!1,t.data.sidePanelName=null}e.closeSidePanel=r,e.shared=t.data};a.$inject=["$scope","$mdSidenav","SharedDataService"],e.controller("SidePanelCtrl",a)}(app),function(e){var a=function(e,a,t,r,n){function o(){e._writeSettingsToLocalStorage(e.sFormData),r.data.apiSettings=e.sFormData,e.updateSla()}function i(){var a,t;r.data.apiSettings={},t=e._readSettingsFromLocalStorage(),angular.copy(t,r.data.apiSettings),a=r.data.apiSettings,n.isTrueObject(a)&&e.shared.acceptedSettings.forEach(function(t){e.sFormData[t]=a.hasOwnProperty(t)?a[t]:""})}e.saveSettings=o,e.fillOutForm=i,e.shared=r.data,e.sFormData={},e.$on("openPanel",function(a,t){"settings"===t.panelName&&e.fillOutForm()})};a.$inject=["$scope","$mdSidenav","Restangular","SharedDataService","HelpersService"],e.controller("SettingsCtrl",a)}(app),function(e){var a=function(e,a,t,r,n,o,i,l,s){function c(){var a=e._readSettingsFromLocalStorage();n.data.apiSettings={},angular.copy(a,n.data.apiSettings),e.updateSla(),s(function(){e.updateSla()},2e3)}function p(){function a(a){if(console.log(a),Array.isArray(a)){var t;if(0===a.length)e.pathNames=[];else{var r,n=[];for(r in e.pathNames)e.pathNames.hasOwnProperty(r)&&n.push(r);for(t=0;t<a.length;t++){var o;e.pathNames.hasOwnProperty(a[t].Path)?(e.pathNames[a[t].Path].status="update",o=n.indexOf(a[t].Path),o>-1&&n.splice(o,1)):e.pathNames[a[t].Path]={name:a[t].Path,status:"new"}}n.forEach(function(a){delete e.pathNames[a]}),window.setTimeout(function(){a.forEach(function(a){var t=a.Path,r=e.pathNames[t];switch(r.status){case"new":e.pathNames[t].chartData={pathComplChart:{instance:i.createDonutChart({htmlId:"pathComplChart",reversePercentage:!1,labels:{primary:"Path comp.",secondary:"Path non-compl."},activePercentage:a["total-percent-packets-in-policy"]},t)},delayComplChart:{instance:i.createDonutChart({htmlId:"delayComplChart",reversePercentage:!0,labels:{primary:"Delay comp.",secondary:"Delay non-compl."},activePercentage:a["total-percent-delay_out_of_compliance"]},t)},jitterComplChart:{instance:i.createDonutChart({htmlId:"jitterComplChart",reversePercentage:!0,labels:{primary:"Jitter comp.",secondary:"Jitter non-compl."},activePercentage:a["total-percent_jitter_out_of_compliance"]},t)},pktLossChart:{instance:i.createDonutChart({htmlId:"pktLossChart",reversePercentage:!0,labels:{primary:"Pkts in",secondary:"Pkt loss"},activePercentage:a["total-percent-packets-received"]},t)},pathComplDevChart:{instance:i.createBarChart({htmlId:"pathComplDevChart",bars:[{label:"Last 1 min",value:a["1min-percent-packets-out-of-policy"]},{label:"Last 15 min",value:a["15min-percent-packets-out-of-policy"]},{label:"Last 1 hr",value:a["1hr-percent-packets-out-of-policy"]}]},t)},delayComplDevChart:{instance:i.createBarChart({htmlId:"delayComplDevChart",bars:[{label:"<1% deviation",value:a.delay_compliance_deviation_1},{label:"1%-10% deviation",value:a.delay_compliance_deviation_10},{label:">10% deviation",value:a.delay_compliance_deviation_g10}]},t)},jitterComplDevChart:{instance:i.createBarChart({htmlId:"jitterComplDevChart",bars:[{label:"<1% deviation",value:a.jitter_compliance_deviation_1},{label:"1%-10% deviation",value:a.jitter_compliance_deviation_10},{label:">10% deviation",value:a.jitter_compliance_deviation_g10}]},t)},pktLossDevChart:{instance:i.createBarChart({htmlId:"pktLossDevChart",bars:[{label:"Last 1 min",value:a["1min-percent-packets-lost"]},{label:"Last 15 min",value:a["15min-percent-packets-lost"]},{label:"Last 1 hr",value:a["1hr-percent-packets-lost"]}]},t)}};break;case"update":var n;for(n in e.pathNames[t].chartData)if(e.pathNames[t].chartData.hasOwnProperty(n)){var o=e.pathNames[t].chartData[n].instance;o.update()}}})},300)}}}function t(e){o.log(e)}return l.isTrueObject(n.data.apiSettings)?void(l.hasOwnProperties(n.data.apiSettings,n.data.acceptedSettings)&&(angular.copy(e.pathNames),r.getSla(n.data.apiSettings,a,t))):1}function d(a,t){switch(t=t||null,a){case"settings":n.data.sidePanel=!0,n.data.sidePanelName=a;break;default:n.data.sidePanel=!0,n.data.sidePanelName=a}e.$root.$broadcast("openPanel",{panelName:a})}function u(){var e,a;e=window.localStorage.getItem("ioamDashboardSettings");try{a=JSON.parse(e)}catch(t){return{}}return a}function h(e){var a=JSON.stringify(e);window.localStorage.setItem("ioamDashboardSettings",a)}e.init=c,e.updateSla=p,e.openPanel=d,e._readSettingsFromLocalStorage=u,e._writeSettingsToLocalStorage=h,e.shared=n.data,e.oldPathNames={},e.pathNames={},e.shared.acceptedSettings=["url","startTime","endTime","targetDelay","targetJitter"],e.init()};a.$inject=["$scope","$mdSidenav","$mdDialog","ApiService","SharedDataService","ErrorHandlerService","ChartService","HelpersService","$interval"],e.controller("IoamAppCtrl",a)}(app);